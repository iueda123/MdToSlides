---
title: "Quarto × reveal.js による スライド作成"
author: "ラボ共有資料"
date: last-modified
lang: ja
format:
  revealjs:
    theme: [default, simple]
    slide-number: true
    embed-resources: true
    toc: true
    toc-depth: 1
    code-line-numbers: true
    transition: fade
    incremental: false
    controls: true
  pdf:
    documentclass: beamer
    theme: metropolis
    slide-level: 2
    toc: false
---

# このデモの目的

- Markdown 1ファイルから reveal.js スライドを生成する
- このデモ自体に基本事項を収めつつ誰でも再現できるようにする
- スライドをPDFやPPTXにも落とし込んで配布や加工に備える

::: notes
ブラウザ登壇を主にしつつ、査読や資料配布でPDFが求められたときの逃げ道を確保しておきたい、という前提を共有。
:::

------

# 前提知識

## Quarto と reveal.js の役割分担

- **Quarto** = Markdown を多形式に変換する統合ビルドツール（Pandoc・Jupyter を内包）
- **reveal.js** = ブラウザ上でスライドを描画するプレゼンエンジン
- `.qmd` 1つで HTML スライドと PDF, PTTX 生成を両立させる

::: notes
Quarto が「Markdown → reveal.js 構造化 HTML」への変換とオプション注入を行い、reveal.js が実際のアニメーション・ナビゲーションを提供する。
:::

## `.qmd` と `.md` の違い

- 冒頭の **YAML front matter** で `format` 設定・タイトル・言語等を定義
- `::: notes` や `::: {.columns}` など **Pandoc fenced divs** が使える
- `` ```{python} `` のような**コードチャンク**で実行ブロックを記述可能
- `.md` より「構造＋設定」を厳密に書ける代わりに、YAML 記法や fenced div を覚える必要がある

## ディレクトリ構成

```text
demo/
├── slides.qmd       # 原稿（このファイル）
├── slides.html      # reveal.js 版（quarto render --to revealjs）
├── slides.pdf       # PDF 版（Chrome ヘッドレス印刷）
├── img/             # 図表ファイル
│   ├── figure-half.svg
│   ├── figure-top.svg
│   └── figure-quarter.svg
└── Makefile         # ワンコマンドビルド
```

--------------

# 基本事項（アニメーション、レイアウト以外）

## ワークフロー

1. `quarto check` で依存関係（Pandoc / LaTeX 等）を確認
2. `quarto preview slides.qmd` でライブプレビュー
3. `quarto render slides.qmd --to revealjs` で HTML 確定
4. `google-chrome --headless --print-to-pdf` で配布用 PDF を生成

::: notes
`quarto render --to revealjs` は .qmd の YAML を読み取り、Pandoc 経由で reveal.js 互換 HTML を生成するコマンド。`--to pdf` `--to pptx` など同じ原稿から別形式も作成できる。
:::

makeコマンドとの関係は？

## TOCの自動生成

  - slides.qmd の YAML front matter で `toc: true` とすると表示される
  - TOCの深さは `toc-depth` で調整できる。
    - TOCの項目数が多すぎるときは深さを浅くする（ 2 とすれば `##` レベルまでが表示）
      - slides.qmd の format.revealjs に toc-depth: 1 などを追加すると、## だけ表示されて行数が減ります。
  - TOCを細く制御したいときは `toc: false` として自作スライドに置き換える

```yaml
:
format:
  revealjs:
    toc: true
    toc-depth: 1
:        
```

## embed-resources: true でメディア埋め込み

- CSS / JS / 画像を 1 つの HTML にバンドル（Base64 化してインライン展開）
- ネットワークに接続できない会場やファイル単体配布に便利
- ファイルサイズは大きくなるので、動画は外部ファイルのままが無難

```
:
format:
  revealjs:
    theme: [default, simple]
    slide-number: true
    embed-resources: true
:
```


## スピーカーノートの使い方

1. 本文の後に `::: notes` ブロックを置く
2. Markdown で台本を書く（箇条書きも可）
3. reveal.js のプレゼンタービュー（`s` キー）で登壇者だけが確認できる

::: notes
`quarto render --to pptx` で PowerPoint 出力した場合はノート欄に転記される。特定の読み上げ規格には依存しない。
:::


## コードブロックの表示

**bash**
```bash
# HTML スライド生成
quarto render slides.qmd --to revealjs

# Chrome ヘッドレスで PDF 化
google-chrome --headless --disable-gpu --no-sandbox \
    --disable-dev-shm-usage --print-to-pdf="$(pwd)/slides.pdf" \
    "file://$(pwd)/slides.html?print-pdf"
```

**python**
```python
# デモ用: プレースホルダデータを生成
import numpy as np
np.random.seed(42)
noise = np.random.normal(size=100)
trend = np.linspace(0, 1, 100)
data = trend + 0.2 * noise
print(data[:5])
```

## 実行ブロック

```{bash}
echo "これはbashスクリプトの実行結果です"
echo "---- Files in Current Dir ----"
ls -1 | head -n 5
```

- 上記は 実行ブロックの例
- コードブロック冒頭のスクリプトエンジン名を `{〜}` で囲むとコマンド出力結果を埋込
- Quarto のコードブロックは bash, python, Knitr / Jupyter 等実行にも対応

------------------------

# アニメーション


## アニメーションの制御

  * スライドの切り替え
    * `transition: slide`: 滑るように
    * `transition: fade`: 消えるように
  * 行の表示
    * `incremental: true` 段階的表示
    * `incremental: false` 一括表示



## 段階表示 (incremental)

- YAML で `format.revealjs.incremental: true` と書くとリスト要素が段階表示になる
- `:::{.incremental}` を本文側に書いて局所的にオンにすることも可能
- ここでは 1 クリックごとに行が表示される
- ここでは 1 クリックごとに行が表示される


## セクションとサブスライド

- `##` 見出しごとに1枚のスライド（水平方向、左右キーで移動）
- 同じ `##` の直後に `###` を書くと垂直サブスライドになる（上下キーで移動）

### サブスライド A

* セクション内の1ページ目。

### サブスライド B

* 2ページ目。
* サブスライドは部分的一括表示に便利？



## ブランクページ

  * `----` はブランクページ

---------------------

# レイアウト

## カラムレイアウト１

図を右側に配置したい場合などに有効

::: {.columns}
::: {.column width="70%"}
- 2カラム構成にして右側を画像に割り当て
- 左カラムに箇条書きや説明を置くと読みやすい
- `width` 属性でカラム比を微調整可能
:::

::: {.column width="30%"}
![キャプション](img/figure-half.svg){width=100%}
:::
:::


## 図を上部に配置

::: {.layout-split style="display:grid; grid-template-rows:40% 60%; height:80vh;"}

::: {.row-top style="display:flex; justify-content:center; align-items:flex-end;"}
![これはキャプションです。](img/figure-top.svg){width=80%}
:::

::: {.row-bottom style="padding:0 1rem 1rem;"}
- 上段と下段を明示的な入れ子ブロックで分ける
- `grid-template-rows:40% 60%` 上下2段の高さの配分
- `height:70vh` コンテナ全体高を表示領域高の７割に
  -  例: `grid-template-rows:30% 70%` かつ `height:70vh` の場合、上段は画面高の 21%（0.3 × 70vh）、下段は画面高の 49%（0.7 × 70vh）
- 配置は各ブロック内で `flex` などを使って調整する
{: style="margin:0;"}
:::

:::


## 図を左下と右下に表示

::: {.layout-split style="display:grid; grid-template-rows:70% 30%; height:70vh;"}
- 上段に本文、下段に左右2つの図を並べる
- 下段は 2 カラムで左右に配置し、両端へ寄せる
- 小さな比較図や補足図を同時に置きたいときに便利

::: {.bottom-pair style="display:grid; grid-template-columns:1fr 1fr; align-items:end; gap:2rem;"}
::: {.left-figure style="justify-self:start; width:100%;"}
![図１](img/figure-quarter.svg){width=90%}
:::

::: {.right-figure style="justify-self:end; width:100%;"}
![図２](img/figure-quarter.svg){width=90%}
:::
:::
:::



----------------------

# ファイルフォーマット変換

## PDF 化手段には複数ある

- **Chrome 印刷**: `?print-pdf` モードで登壇画面と同じ状態をそのまま PDF 化
  - `--no-sandbox --disable-dev-shm-usage` は CI でも安定する定番フラグ
- **LaTeX**: `quarto render slides.qmd --to pdf` で Beamer ベースの PDF を生成（要 TeX 環境）

::: notes
reveal.js の `?print-pdf` は公式ルートなので基本は安定。段階表示の一括表示には `pdfSeparateFragments: true` を組み合わせる。
:::


## PPTX化

- `quarto render slides.qmd --to pptx` で PowerPoint 形式に変換
- レイアウトはスライド母版よりも「1枚ごとの要素配置」に近い
- reveal.js 固有のアニメーションは PPTX には引き継がれない
- ノートは `::: notes` の内容が PowerPoint のノート欄に入る

```bash
quarto render slides.qmd --to pptx
```


# CI での自動ビルド

- `quarto render` で HTML/PDF/PPTX をまとめて生成
- `quarto check` を先に走らせると環境差分に気づきやすい
- 成果物（slides.html / slides.pdf / slides.pptx）をアーティファクト化

```yaml
name: build-slides
on: [push]
jobs:
  render:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: quarto-dev/quarto-actions/setup@v2
      - run: quarto check
      - run: quarto render slides.qmd --to revealjs
      - run: quarto render slides.qmd --to pdf
      - run: quarto render slides.qmd --to pptx
```

::: notes
CI = Continuous Integration（継続的インテグレーション）。GitHub Actions のような自動実行基盤でビルドを回し、配布物を安定生成する、という意図を補足する。
CI 例: GitHub Actions で `quarto render` → `google-chrome --headless --print-to-pdf` を走らせ、slides.html と slides.pdf をアーティファクト化。
:::

--------------------------

# まとめ

- Markdown 1ファイルから reveal.js スライドを生成できる
- このデモに基本事項とレイアウト例をまとめ、再現しやすくしている
- PDF/PPTX へも同じ原稿から展開できる

